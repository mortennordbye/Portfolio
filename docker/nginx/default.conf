# Redirect www -> apex
server {
    listen 8080;
    server_name www.nordbye.it;
    return 301 http://nordbye.it$request_uri;
}

# Primary vhost (static only, no uploads)
server {
    listen 8080 default_server;
    server_name nordbye.it stage.nordbye.it;

    root   /usr/share/nginx/html/nordbye.it;
    index  index.html index.htm;

    # Only allow safe methods; avoids body buffering and temp files
    location / {
        limit_except GET HEAD { deny all; }
        try_files $uri $uri/ =404;
    }

    # Lightweight health endpoint
    location /healthz {
        access_log off;
        return 200 "ok\n";
        add_header Content-Type text/plain;
    }

    # Error pages (served from read-only content)
    error_page 404 /errors/404.html;
    error_page 403 /errors/403.html;
    error_page 500 502 503 504 /errors/50x.html;

    location = /errors/404.html { internal; }
    location = /errors/403.html { internal; }
    location = /errors/50x.html { internal; }
}
